{{ $cluster := .Get "cluster" }}
{{ $title := .Get "title" }}
{{ $description := .Get "description" }}
{{ $items := where site.Data.partners "cluster" $cluster }}

{{/* Cluster Map for CSS classes */}}
{{ $clusterMap := dict
    "Global Intergovernmental Organizations" "global-orgs"
    "Reproducibility Networks" "repro-networks"
    "Open Science Infrastructure" "os-infrastructure"
    "Education & Training" "education"
    "Research Communities" "research-communities"
    "Early Career & Equity" "ecr-equity"
    "Institutional Partners" "institutional"
}}

<div class="partner-section-group" data-cluster="{{ $cluster }}">
    {{ if $title }}
    <div class="section-heading" align="center">
        <h2>{{ $title | markdownify }}</h2>
        <hr>
        {{ if $description }}
        <div class="partner-section-description">
            {{ $description | markdownify }}
        </div>
        {{ end }}
    </div>
    {{ end }}
    <div class="partner-list" style="display: flex; flex-direction: column; gap: 1rem; margin-top: 1rem;">
        {{ range $items }}
        {{ $clusterClass := index $clusterMap .cluster | default "default" }}
        <div class="partner-card" data-aos="fade-up" data-cluster="{{ .cluster }}"
            {{ if .status }}data-status="{{ .status }}"{{ end }}
            {{ if .project_specific }}data-project="true"{{ end }}
            style="background: #FEFDF6; border-radius: 8px; box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); border: 1px solid rgba(0, 0, 0, 0.1); padding: 1.25rem; margin-bottom: 0.5rem;">
            <div class="partner-card-body">

                <div class="partner-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.75rem;">
                    <div class="partner-tags" style="display: flex; flex-wrap: wrap; gap: 6px;">
                        {{/* Cluster Pill */}}
                        <span class="partner-pill pill-{{ $clusterClass }}" style="display: inline-block; padding: 0.2em 0.6em; font-size: 0.75rem; font-weight: 500; border-radius: 50rem;">{{ .cluster }}</span>
                        {{ if .status }}
                        <span class="partner-pill pill-status-{{ .status }}" style="display: inline-block; padding: 0.2em 0.6em; font-size: 0.75rem; font-weight: 500; border-radius: 50rem;">{{ .status | title }}</span>
                        {{ end }}
                        {{ if .project_specific }}
                        <span class="partner-pill pill-project" style="display: inline-block; padding: 0.2em 0.6em; font-size: 0.75rem; font-weight: 500; border-radius: 50rem; background-color: #d3f9d8; color: #2b8a3e;">Project Partner</span>
                        {{ end }}
                    </div>
                </div>

                <div class="partner-content" style="display: flex; gap: 1.5rem; align-items: flex-start; margin-bottom: 1rem;">
                    <div class="partner-logo-container" style="flex-shrink: 0; width: 120px; min-width: 120px; display: flex; align-items: center; justify-content: center;">
                        {{ if .logo }}
                        <a href="{{ .url }}" target="_blank" rel="noopener" style="display: flex; align-items: center; justify-content: center;">
                            <img src="logos/{{ .logo }}" alt="{{ .name }} logo" class="partner-logo" loading="lazy" style="max-width: 120px; max-height: 80px; width: auto; height: auto; object-fit: contain;">
                        </a>
                        {{ end }}
                    </div>
                    <div class="partner-info" style="flex: 1; min-width: 0;">
                        <h3 class="partner-title" style="font-size: 1.1rem; font-weight: 700; color: #212529; margin-bottom: 0.5rem; line-height: 1.35;">
                            <a href="{{ .url }}" target="_blank" rel="noopener" style="color: inherit; text-decoration: none;">{{ .name }}</a>
                        </h3>
                        <div class="partner-description" style="font-size: 0.9rem; color: #495057; line-height: 1.6;">
                            {{ .description | markdownify }}
                        </div>
                    </div>
                </div>

                <div class="partner-footer" style="display: flex; flex-wrap: wrap; justify-content: flex-start; align-items: center; gap: 0.5rem; padding-top: 0.75rem; border-top: 1px solid #f1f3f5;">
                    <div class="partner-buttons" style="display: flex; gap: 0.35rem; flex-wrap: wrap;">
                        {{ if .url }}
                        <a href="{{ .url }}" target="_blank" rel="noopener" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-external-link-alt"></i> Visit Website
                        </a>
                        {{ end }}
                        {{ if .additional_link }}
                        <a href="{{ .additional_link }}" target="_blank" rel="noopener" class="btn btn-outline-info btn-sm">
                            <i class="fas fa-file-alt"></i> {{ .additional_link_text | default "Learn More" }}
                        </a>
                        {{ end }}
                        {{ if .project_link }}
                        <a href="{{ .project_link }}" class="btn btn-outline-success btn-sm">
                            <i class="fas fa-project-diagram"></i> {{ .project_name | default "Project" }}
                        </a>
                        {{ end }}
                    </div>
                </div>

            </div>
        </div>
        {{ end }}
    </div>
</div>
