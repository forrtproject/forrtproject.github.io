{{/* Steering Committee and People Widget - Redesigned */}}

{{ $root := .root }}
{{ $page := .page }}
{{ $show_social := $page.Params.design.show_social | default false }}
{{ $show_interests := $page.Params.design.show_interests | default true }}
{{ $enable_subsections := $page.Params.design.enable_subsections | default false }}
{{ $show_all := $page.Params.content.show_all | default false }}
{{ $is_sc_page := eq $root.RelPermalink "/about/steering-committee/" }}

{{ if $is_sc_page }}
<div class="people-widget">
  {{ with $page.Content }}
  <div class="page-header">
    {{ . }}
  </div>
  {{ end }}

  {{ range $page.Params.content.user_groups }}
  {{ $group_name := . }}
  {{ $query := where (where site.Pages "Section" "authors") ".Params.user_groups" "intersect" (slice .) }}

  {{ if $query }}
  <div class="section-heading-container">
    <h2 class="section-heading">
      {{ $icon := "" }}
      {{ $group_lower := lower $group_name }}
      {{ if in $group_lower "focus area" }}{{ $icon = "target" }}{{ else if or (in $group_lower "operation") (in
      $group_lower "steward") (in $group_lower "ombudsman") }}{{ $icon = "settings" }}{{ else if in $group_lower
      "steering" }}{{ $icon = "anchor" }}{{ else }}{{ $icon = "target" }}{{ end }}
      <svg class="section-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round">
        {{ if eq $icon "target" }}
        <circle cx="12" cy="12" r="1" />
        <circle cx="19" cy="12" r="1" />
        <circle cx="5" cy="12" r="1" />
        <circle cx="12" cy="5" r="1" />
        <circle cx="12" cy="19" r="1" />
        <circle cx="12" cy="12" r="7" />
        {{ else if eq $icon "settings" }}
        <circle cx="12" cy="12" r="3" />
        <path
          d="M12 1v6m0 6v6M4.22 4.22l4.24 4.24m4.96 4.96l4.24 4.24M1 12h6m6 0h6M4.22 19.78l4.24-4.24m4.96-4.96l4.24-4.24" />
        {{ else if eq $icon "anchor" }}
        <circle cx="12" cy="5" r="1" />
        <path d="M12 6v12M12 18H8v-1c0-1.5 1-3 4-3s4 1.5 4 3v1h-4" />
        {{ else }}
        <circle cx="12" cy="12" r="1" />
        <circle cx="19" cy="12" r="1" />
        <circle cx="5" cy="12" r="1" />
        <circle cx="12" cy="5" r="1" />
        <circle cx="12" cy="19" r="1" />
        <circle cx="12" cy="12" r="7" />
        {{ end }}
      </svg>
      {{ $group_name | markdownify | emojify }}
    </h2>
    {{ with $page.Params.subtitle }}<p class="section-subtitle">{{ . | markdownify | emojify }}</p>{{ end }}
  </div>
  {{ end }}

  {{ if $enable_subsections }}
  {{ $teams := dict }}
  {{ $team_order := slice }}
  {{ $uncategorized := slice }}

  {{ range $query }}
  {{ $team := trim (.Params.team | default "") " " }}

  {{ if $team }}
  {{ if not (index $teams $team) }}
  {{ $team_order = $team_order | append $team }}
  {{ end }}
  {{ $members := (index $teams $team) | default slice }}
  {{ $members = $members | append . }}
  {{ $teams = merge $teams (dict $team $members) }}
  {{ else }}
  {{ $uncategorized = $uncategorized | append . }}
  {{ end }}
  {{ end }}

  {{ $group_lower := lower $group_name }}
  {{ $team_class := "" }}
  {{ if in $group_lower "focus" }}
  {{ $team_class = "focus-areas" }}
  {{ else if or (in $group_lower "operation") (in $group_lower "steward") (in $group_lower "ombudsman") }}
  {{ $team_class = "operations" }}
  {{ else if in $group_lower "steering" }}
  {{ $team_class = "steering" }}
  {{ else }}
  {{ $team_class = "focus-areas" }}
  {{ end }}

  {{ if and $is_sc_page (or (gt (len $team_order) 0) (gt (len $uncategorized) 0)) }}
  {{ $items := slice }}
  {{ range $team_order }}
  {{ $team := . }}
  {{ $items = $items | append (dict "kind" "team" "name" $team) }}
  {{ range index $teams $team }}
  {{ $items = $items | append (dict "kind" "member" "person" .) }}
  {{ end }}
  {{ end }}
  {{ range $uncategorized }}
  {{ $items = $items | append (dict "kind" "member" "person" .) }}
  {{ end }}

  <div class="people-grid people-grid--flow">
    {{ range $items }}
    {{ if eq .kind "team" }}
    <div class="team-title-card {{ $team_class }} team-title-card--inline">
      <div class="team-title-card-text">
        <div class="team-title-card-label">Team</div>
        <h3 class="team-title-card-name">{{ .name | markdownify }}</h3>
      </div>
      <div class="team-title-card-arrow" aria-hidden="true">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
          stroke-linejoin="round">
          <polyline points="9 18 15 12 9 6"></polyline>
        </svg>
      </div>
    </div>
    {{ else }}
    {{ partial "widgets/people-card.html" (dict "person" .person "show_social" $show_social "is_sc_page" $is_sc_page) }}
    {{ end }}
    {{ end }}
  </div>
  {{ else }}
  <div class="people-container">
    {{ range $team_order }}
    {{ $team := . }}
    <div class="people-subsection">
      <div class="subsection-heading">
        <div class="team-title-card {{ $team_class }}">
          <div class="team-title-card-label">Team</div>
          <h3 class="team-title-card-name">{{ $team | markdownify }}</h3>
        </div>
      </div>

      <div class="people-items">
        {{ range index $teams $team }}
        {{ partial "widgets/people-card.html" (dict "person" . "show_social" $show_social "is_sc_page" $is_sc_page) }}
        {{ end }}
      </div>
    </div>
    {{ end }}

    {{ if gt (len $uncategorized) 0 }}
    <div class="people-items">
      {{ range $uncategorized }}
      {{ partial "widgets/people-card.html" (dict "person" . "show_social" $show_social "is_sc_page" $is_sc_page) }}
      {{ end }}
    </div>
    {{ end }}
  </div>
  {{ end }}

  {{ else }}
  <div class="people-container">
    {{ range $query }}
    {{ partial "widgets/people-card.html" (dict "person" . "show_social" $show_social "is_sc_page" $is_sc_page) }}
    {{ end }}
  </div>
  {{ end }}
  {{ end }}
</div>
{{ else }}
<div class="row justify-content-center people-widget">
  {{ with $page.Title }}
  <div class="col-md-12 section-heading">
    <h1>{{ . | markdownify | emojify }}</h1>
    {{ if $page.Params.subtitle }}<p>{{ $page.Params.subtitle | markdownify | emojify }}</p>{{ end }}
  </div>
  {{ end }}

  {{ with $page.Content }}
  <div class="col-md-12">
    {{ . }}
  </div>
  {{ end }}


  {{ if $show_all }}
  <div class="col-md-12">
    <div class="row">
      {{ $authors := where site.Pages "Section" "authors" }}
      {{ $authors = where $authors "Params.name" "!=" nil }}
      {{ range sort $authors "Params.name" }}
      <div class="col-12 col-sm-auto col-md-4 people-person py-3">
        {{ partial "widgets/people-card.html" (dict "person" . "show_social" $show_social "is_sc_page" false) }}
      </div>
      {{ end }}
    </div>
  </div>
  {{ else }}
  {{ range $page.Params.content.user_groups }}
  {{ $query := where (where site.Pages "Section" "authors") ".Params.user_groups" "intersect" (slice .) }}

  {{ if $query }}
  <div class="col-md-12">
    <h2 class="mb-4">{{ . | markdownify | emojify }}</h2>
  </div>
  {{ end }}

  <div class="col-md-12">
    <div class="row">
      {{ range $query }}
      <div class="col-12 col-sm-auto col-md-4 people-person py-3">
        {{ partial "widgets/people-card.html" (dict "person" . "show_social" $show_social "is_sc_page" false) }}
      </div>
      {{ end }}
    </div>
  </div>
  {{ end }}
  {{ end }}
</div>
{{ end }}